<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Joki Tugas Invoice Generator</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- HTML2Canvas -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        .font-heading { font-family: 'Space Grotesk', sans-serif; }
        
        /* Hide scrollbar for clean UI */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }

        /* Aspect Ratio 4:5 Container Calculation */
        /* 1080 / 1350 = 0.8 */
        .invoice-ratio {
            aspect-ratio: 4/5;
        }
        
        /* Preview styling specifically for capture */
        #invoice-capture {
            background: white;
            /* Ensures generated image has high quality text */
            -webkit-font-smoothing: antialiased; 
            -moz-osx-font-smoothing: grayscale;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const App = () => {
            // --- STATE MANAGEMENT ---
            const [invoiceMeta, setInvoiceMeta] = useState({
                number: `INV-${new Date().getFullYear()}${String(new Date().getMonth()+1).padStart(2, '0')}${String(Math.floor(Math.random() * 100))}`,
                date: new Date().toISOString().slice(0, 10),
                clientName: '',
                paymentMethod: 'TF', // TF or COD
                status: 'LUNAS', // LUNAS, DP, BELUM
                dpAmount: 0,
                adminName: 'Admin Joki'
            });

            const [items, setItems] = useState([
                { id: 1, title: 'Makalah Hukum', deadline: '2025-12-03', desc: 'Include Turnitin < 20%', price: 150000 }
            ]);

            const [paymentInfo, setPaymentInfo] = useState({
                bankName: 'BCA',
                accountNumber: '1234567890',
                accountName: 'Nama Kamu',
                eWallet: 'DANA: 0812-3456-7890'
            });

            const [isGenerating, setIsGenerating] = useState(false);

            // --- HANDLERS ---
            const handleMetaChange = (e) => {
                const { name, value } = e.target;
                setInvoiceMeta(prev => ({ ...prev, [name]: value }));
            };

            const handlePaymentInfoChange = (e) => {
                const { name, value } = e.target;
                setPaymentInfo(prev => ({ ...prev, [name]: value }));
            };

            const handleItemChange = (id, field, value) => {
                setItems(prev => prev.map(item => 
                    item.id === id ? { ...item, [field]: value } : item
                ));
            };

            const addItem = () => {
                const newId = items.length > 0 ? Math.max(...items.map(i => i.id)) + 1 : 1;
                setItems([...items, { id: newId, title: '', deadline: '', desc: '', price: 0 }]);
            };

            const removeItem = (id) => {
                setItems(items.filter(item => item.id !== id));
            };

            // --- CALCULATIONS ---
            const subtotal = items.reduce((sum, item) => sum + Number(item.price), 0);
            const total = subtotal; // Can add tax/discount logic here later
            
            const formatRupiah = (number) => {
                return new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 }).format(number);
            };

            const formatDateIndo = (dateString) => {
                if(!dateString) return '-';
                const options = { day: 'numeric', month: 'short', year: 'numeric' };
                return new Date(dateString).toLocaleDateString('id-ID', options);
            };

            // --- IMAGE GENERATION ---
            const downloadInvoice = async () => {
                setIsGenerating(true);
                const element = document.getElementById('invoice-capture');
                
                try {
                    // Create canvas with high scale for crisp text
                    const canvas = await html2canvas(element, {
                        scale: 2, 
                        useCORS: true,
                        backgroundColor: '#ffffff'
                    });
                    
                    const image = canvas.toDataURL("image/png");
                    const link = document.createElement('a');
                    link.href = image;
                    link.download = `Invoice-${invoiceMeta.clientName}-${invoiceMeta.number}.png`;
                    link.click();
                } catch (error) {
                    console.error("Gagal generate gambar", error);
                    alert("Gagal membuat gambar. Coba lagi.");
                } finally {
                    setIsGenerating(false);
                }
            };

            // --- RENDER ---
            return (
                <div className="min-h-screen flex flex-col lg:flex-row text-gray-800">
                    
                    {/* LEFT PANEL: INPUT FORM */}
                    <div className="w-full lg:w-1/2 p-6 overflow-y-auto h-screen bg-white shadow-xl z-10">
                        <div className="mb-8">
                            <h1 className="text-2xl font-bold text-indigo-600 font-heading mb-2">
                                <i className="fas fa-robot mr-2"></i>Joki Generator
                            </h1>
                            <p className="text-gray-500 text-sm">Isi data tugas di bawah ini, preview akan muncul otomatis.</p>
                        </div>

                        {/* Invoice Meta */}
                        <div className="space-y-4 mb-8 border-b pb-6">
                            <h3 className="font-semibold text-gray-700">Info Dasar</h3>
                            <div className="grid grid-cols-2 gap-4">
                                <div>
                                    <label className="block text-xs font-medium text-gray-500 mb-1">No. Invoice</label>
                                    <input type="text" name="number" value={invoiceMeta.number} onChange={handleMetaChange} className="w-full p-2 border rounded focus:ring-2 focus:ring-indigo-500 outline-none text-sm" />
                                </div>
                                <div>
                                    <label className="block text-xs font-medium text-gray-500 mb-1">Tanggal</label>
                                    <input type="date" name="date" value={invoiceMeta.date} onChange={handleMetaChange} className="w-full p-2 border rounded focus:ring-2 focus:ring-indigo-500 outline-none text-sm" />
                                </div>
                                <div className="col-span-2">
                                    <label className="block text-xs font-medium text-gray-500 mb-1">Nama Client</label>
                                    <input type="text" name="clientName" placeholder="Contoh: Kak Budi" value={invoiceMeta.clientName} onChange={handleMetaChange} className="w-full p-2 border rounded focus:ring-2 focus:ring-indigo-500 outline-none text-sm" />
                                </div>
                            </div>
                        </div>

                        {/* Payment Status */}
                        <div className="space-y-4 mb-8 border-b pb-6">
                            <h3 className="font-semibold text-gray-700">Status & Metode</h3>
                            <div className="grid grid-cols-2 gap-4">
                                <div>
                                    <label className="block text-xs font-medium text-gray-500 mb-1">Status Bayar</label>
                                    <select name="status" value={invoiceMeta.status} onChange={handleMetaChange} className="w-full p-2 border rounded bg-white text-sm">
                                        <option value="LUNAS">LUNAS</option>
                                        <option value="DP">DP (Uang Muka)</option>
                                        <option value="BELUM">BELUM BAYAR</option>
                                    </select>
                                </div>
                                <div>
                                    <label className="block text-xs font-medium text-gray-500 mb-1">Metode Bayar</label>
                                    <select name="paymentMethod" value={invoiceMeta.paymentMethod} onChange={handleMetaChange} className="w-full p-2 border rounded bg-white text-sm">
                                        <option value="TF">Transfer Bank/E-Wallet</option>
                                        <option value="COD">COD (Bayar Nanti)</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        {/* Tasks List */}
                        <div className="space-y-4 mb-8 border-b pb-6">
                            <div className="flex justify-between items-center">
                                <h3 className="font-semibold text-gray-700">Daftar Tugas</h3>
                                <button onClick={addItem} className="text-xs bg-indigo-100 text-indigo-700 px-3 py-1 rounded hover:bg-indigo-200 transition">
                                    <i className="fas fa-plus mr-1"></i> Tambah Tugas
                                </button>
                            </div>
                            
                            {items.map((item, index) => (
                                <div key={item.id} className="bg-gray-50 p-4 rounded-lg relative group border border-gray-200">
                                    <button onClick={() => removeItem(item.id)} className="absolute top-2 right-2 text-gray-400 hover:text-red-500 transition opacity-0 group-hover:opacity-100">
                                        <i className="fas fa-trash"></i>
                                    </button>
                                    
                                    <div className="grid gap-3">
                                        <div>
                                            <input 
                                                type="text" 
                                                placeholder="Judul Tugas (Misal: Makalah PKN)" 
                                                value={item.title} 
                                                onChange={(e) => handleItemChange(item.id, 'title', e.target.value)}
                                                className="w-full bg-transparent border-b border-gray-300 focus:border-indigo-500 outline-none font-medium text-sm pb-1"
                                            />
                                        </div>
                                        <div className="flex gap-2">
                                            <div className="w-1/3">
                                                <label className="text-[10px] text-gray-400 uppercase">Deadline</label>
                                                <input 
                                                    type="date" 
                                                    value={item.deadline} 
                                                    onChange={(e) => handleItemChange(item.id, 'deadline', e.target.value)}
                                                    className="w-full bg-transparent border-b border-gray-300 focus:border-indigo-500 outline-none text-xs pb-1"
                                                />
                                            </div>
                                            <div className="w-2/3">
                                                <label className="text-[10px] text-gray-400 uppercase">Harga</label>
                                                <input 
                                                    type="number" 
                                                    placeholder="0" 
                                                    value={item.price} 
                                                    onChange={(e) => handleItemChange(item.id, 'price', e.target.value)}
                                                    className="w-full bg-transparent border-b border-gray-300 focus:border-indigo-500 outline-none text-xs pb-1"
                                                />
                                            </div>
                                        </div>
                                        <div>
                                            <textarea 
                                                placeholder="Deskripsi tambahan (optional)" 
                                                value={item.desc} 
                                                onChange={(e) => handleItemChange(item.id, 'desc', e.target.value)}
                                                className="w-full bg-transparent border-b border-gray-300 focus:border-indigo-500 outline-none text-xs resize-none h-8"
                                            ></textarea>
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>

                         {/* Admin Config */}
                         <div className="space-y-4 mb-20">
                            <h3 className="font-semibold text-gray-700">Info Pembayaran (Admin)</h3>
                            <input type="text" name="bankName" placeholder="Nama Bank/E-Wallet" value={paymentInfo.bankName} onChange={handlePaymentInfoChange} className="w-full p-2 border rounded text-sm mb-2" />
                            <input type="text" name="accountNumber" placeholder="No. Rekening" value={paymentInfo.accountNumber} onChange={handlePaymentInfoChange} className="w-full p-2 border rounded text-sm mb-2" />
                            <input type="text" name="accountName" placeholder="Atas Nama" value={paymentInfo.accountName} onChange={handlePaymentInfoChange} className="w-full p-2 border rounded text-sm" />
                        </div>

                        {/* Floating Action Button for Mobile */}
                        <div className="fixed bottom-0 left-0 w-full lg:w-1/2 p-4 bg-white border-t border-gray-200 lg:static lg:border-none lg:bg-transparent lg:p-0">
                            <button 
                                onClick={downloadInvoice} 
                                disabled={isGenerating}
                                className="w-full bg-indigo-600 text-white py-3 rounded-lg font-bold shadow-lg hover:bg-indigo-700 transition flex justify-center items-center gap-2"
                            >
                                {isGenerating ? <i className="fas fa-spinner fa-spin"></i> : <i className="fas fa-download"></i>}
                                {isGenerating ? 'Memproses...' : 'Download Invoice (4:5)'}
                            </button>
                        </div>
                    </div>

                    {/* RIGHT PANEL: PREVIEW (Visual Output) */}
                    <div className="w-full lg:w-1/2 bg-gray-200 flex items-center justify-center p-4 lg:p-10 lg:fixed lg:right-0 lg:h-screen lg:overflow-hidden">
                        
                        {/* THE INVOICE CANVAS (Aspect Ratio 4:5) */}
                        <div 
                            id="invoice-capture" 
                            className="invoice-ratio bg-white shadow-2xl relative flex flex-col justify-between overflow-hidden"
                            style={{ 
                                width: '100%', 
                                maxWidth: '480px', // Max width to simulate mobile size on desktop
                                // We don't set height, aspect-ratio handles it
                            }}
                        >
                            {/* Decorative Top Bar */}
                            <div className="h-2 w-full bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500"></div>

                            {/* Header */}
                            <div className="px-8 pt-8 pb-4 flex justify-between items-start">
                                <div>
                                    {/* Logo Logic: Try loading LOGO.png, fallback to text */}
                                    <img 
                                        src="LOGO.png" 
                                        alt="Logo Bisnis" 
                                        className="h-12 w-auto object-contain mb-2"
                                        onError={(e) => {
                                            e.target.style.display = 'none';
                                            e.target.nextSibling.style.display = 'block';
                                        }}
                                    />
                                    <h2 className="text-2xl font-bold text-indigo-800 font-heading hidden">JASA TUGAS</h2>
                                    <p className="text-xs text-gray-500 max-w-[150px] leading-tight mt-1">Solusi tugas cepat, aman & terpercaya.</p>
                                </div>
                                <div className="text-right">
                                    <h1 className="text-3xl font-bold text-gray-800 tracking-tight">INVOICE</h1>
                                    <p className="text-sm text-gray-500 font-mono mt-1">#{invoiceMeta.number}</p>
                                    
                                    {/* Status Badge */}
                                    <div className={`mt-3 inline-block px-3 py-1 rounded border-2 font-bold text-xs tracking-wider transform -rotate-2 uppercase
                                        ${invoiceMeta.status === 'LUNAS' ? 'border-green-500 text-green-600 bg-green-50' : 
                                          invoiceMeta.status === 'DP' ? 'border-yellow-400 text-yellow-600 bg-yellow-50' : 
                                          'border-red-400 text-red-500 bg-red-50'}`}>
                                        {invoiceMeta.status}
                                    </div>
                                </div>
                            </div>

                            {/* Client Info Section */}
                            <div className="px-8 py-4 bg-indigo-50/50 flex justify-between items-center mx-6 rounded-lg border border-indigo-100">
                                <div>
                                    <p className="text-[10px] text-gray-500 uppercase tracking-wide font-bold">Kepada</p>
                                    <h3 className="text-lg font-bold text-gray-800">{invoiceMeta.clientName || 'Nama Client'}</h3>
                                </div>
                                <div className="text-right">
                                    <p className="text-[10px] text-gray-500 uppercase tracking-wide font-bold">Tanggal</p>
                                    <p className="text-sm font-medium text-gray-800">{formatDateIndo(invoiceMeta.date)}</p>
                                </div>
                            </div>

                            {/* Main Task List */}
                            <div className="flex-grow px-8 py-6">
                                <p className="text-xs font-bold text-gray-400 uppercase tracking-wider mb-4 border-b pb-2">Detail Pesanan</p>
                                
                                <div className="space-y-6">
                                    {items.map((item) => (
                                        <div key={item.id} className="flex justify-between items-start group">
                                            <div className="pr-4">
                                                {/* H1 Nama Tugas */}
                                                <h4 className="font-bold text-gray-800 text-sm mb-1">{item.title || 'Judul Tugas'}</h4>
                                                
                                                {/* H2 Deadline */}
                                                <div className="flex items-center text-xs text-red-500 font-medium mb-1">
                                                    <i className="far fa-clock mr-1"></i>
                                                    <span>Deadline: {formatDateIndo(item.deadline)}</span>
                                                </div>

                                                {/* H3 Deskripsi */}
                                                {item.desc && (
                                                    <p className="text-[10px] text-gray-500 italic leading-relaxed bg-gray-50 p-1 rounded inline-block">
                                                        Note: {item.desc}
                                                    </p>
                                                )}
                                            </div>
                                            
                                            {/* Harga */}
                                            <div className="text-right whitespace-nowrap">
                                                <span className="font-bold text-gray-800 text-sm">{formatRupiah(item.price)}</span>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>

                            {/* Footer Summary & Payment */}
                            <div className="bg-gray-900 text-white p-8">
                                <div className="flex justify-between items-end mb-6 border-b border-gray-700 pb-4">
                                    <div className="text-xs text-gray-400">
                                        <p>Total Tagihan</p>
                                    </div>
                                    <div className="text-3xl font-bold text-white font-heading">
                                        {formatRupiah(total)}
                                    </div>
                                </div>

                                <div className="flex justify-between items-start">
                                    {/* Payment Method Display */}
                                    <div className="w-2/3">
                                        <p className="text-[10px] uppercase text-gray-400 font-bold mb-2">
                                            {invoiceMeta.paymentMethod === 'COD' ? 'METODE PEMBAYARAN' : 'INFO TRANSFER'}
                                        </p>
                                        
                                        {invoiceMeta.paymentMethod === 'COD' ? (
                                            <div className="bg-white/10 p-2 rounded border border-white/20 inline-block">
                                                <div className="flex items-center gap-2">
                                                    <i className="fas fa-handshake text-yellow-400"></i>
                                                    <div className="text-xs font-bold">CASH ON DELIVERY (COD)</div>
                                                </div>
                                                <div className="text-[10px] text-gray-300 mt-1">Pelunasan dilakukan saat file diterima.</div>
                                            </div>
                                        ) : (
                                            <div className="text-xs space-y-1">
                                                <div className="flex items-center gap-2">
                                                    <span className="font-bold text-indigo-300 w-12">{paymentInfo.bankName}</span>
                                                    <span className="font-mono">{paymentInfo.accountNumber}</span>
                                                </div>
                                                <div className="text-gray-400 pl-14 text-[10px]">a.n {paymentInfo.accountName}</div>
                                                {paymentInfo.eWallet && (
                                                    <div className="flex items-center gap-2 mt-2">
                                                        <i className="fas fa-wallet text-gray-400 w-12 text-center"></i>
                                                        <span>{paymentInfo.eWallet}</span>
                                                    </div>
                                                )}
                                            </div>
                                        )}
                                    </div>

                                    {/* Thank You Note */}
                                    <div className="w-1/3 text-right flex flex-col justify-end h-full">
                                        <img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=TerimaKasih" className="w-12 h-12 ml-auto mb-2 opacity-80 bg-white p-1 rounded" alt="QR" />
                                        <p className="text-[10px] text-gray-400">Terima kasih!</p>
                                        <p className="text-[10px] text-yellow-400 italic">Semangat kuliah!</p>
                                    </div>
                                </div>
                            </div>
                            
                            {/* Bottom Strip */}
                            <div className="bg-indigo-600 h-3 w-full"></div>
                        </div>

                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>